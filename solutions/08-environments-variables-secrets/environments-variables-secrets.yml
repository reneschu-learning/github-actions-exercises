name: Umgebungen, Variablen und Secrets

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        type: choice
        options:
          - development
          - production
        default: 'development'
      deploy_version:
        description: 'Version to deploy'
        required: true
        type: string
        default: 'v1.0.0'

env:
  actor: ${{ github.actor }}
  repository: ${{ github.repository }}

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    
    steps:
      - name: Workflow-Informationen anzeigen
        run: |
          echo "🚀 Deployment in Environment: ${{ inputs.environment }}"
          echo "📦 Version: ${{ inputs.deploy_version }}"
          echo "👤 Ausgelöst von: ${{ env.actor }}"
          echo "🌟 Repository: ${{ env.repository }}"
      
      - name: Repository-Variablen anzeigen
        run: |
          echo "📋 Repository-Variablen:"
          echo "  APP_NAME: ${{ vars.APP_NAME }}"
          echo "  DEFAULT_REGION: ${{ vars.DEFAULT_REGION }}"
      
      - name: Umgebungsvariablen anzeigen
        run: |
          echo "🌍 Umgebungsvariablen:"
          echo "  ENVIRONMENT_NAME: ${{ vars.ENVIRONMENT_NAME }}"
          echo "  API_URL: ${{ vars.API_URL }}"
      
      - name: Variablen-Priorität demonstrieren
        run: |
          echo "🔄 Demo zur Variablen-Priorität:"
          echo "Umgebungsvariablen überschreiben Repository-Variablen mit gleichem Namen"
          echo "Wenn ENVIRONMENT_NAME sowohl im Repository als auch im Environment existiert, gewinnt das Environment"
      
      - name: Secrets verwenden (sicher)
        run: |
          echo "🔐 Secrets werden verwendet (Werte sind maskiert):"
          echo "API_KEY ist verfügbar: ${{ secrets.API_KEY != '' }}"
          echo "DATABASE_PASSWORD ist verfügbar: ${{ secrets.DATABASE_PASSWORD != '' }}"
          
          # Zeigt, dass Secret-Werte automatisch maskiert werden
          echo "Versuch, API_KEY anzuzeigen (wird maskiert): ${{ secrets.API_KEY }}"
